<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Self-Learning AI Betting System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .glass-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
            border: 1px solid rgba(255, 255, 255, 0.18);
        }
        .ai-badge {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: .5; }
        }
    </style>
</head>
<body class="p-4 md:p-8">
    <div class="max-w-7xl mx-auto space-y-6">
        
        <!-- Header -->
        <div class="glass-card p-6">
            <div class="flex items-center justify-between">
                <div>
                    <h1 class="text-3xl font-bold text-gray-900">ü§ñ Self-Learning AI Betting System</h1>
                    <p class="text-gray-600 mt-1">Advanced machine learning for profitable betting</p>
                </div>
                <div class="text-right">
                    <div class="text-sm text-gray-500">AI Status</div>
                    <div class="text-lg font-bold text-green-600">‚óè Learning</div>
                </div>
            </div>
        </div>

        <!-- AI Stats Dashboard -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
            <div class="glass-card p-4">
                <div class="text-sm text-gray-500">Total Bets Analyzed</div>
                <div class="text-2xl font-bold text-gray-900" id="totalBets">0</div>
                <div class="text-xs text-gray-400 mt-1">Lifetime learning</div>
            </div>
            <div class="glass-card p-4">
                <div class="text-sm text-gray-500">Win Rate</div>
                <div class="text-2xl font-bold text-green-600" id="winRate">0%</div>
                <div class="text-xs text-gray-400 mt-1">AI accuracy</div>
            </div>
            <div class="glass-card p-4">
                <div class="text-sm text-gray-500">AI Confidence</div>
                <div class="text-2xl font-bold text-purple-600" id="confidence">0%</div>
                <div class="text-xs text-gray-400 mt-1">Model certainty</div>
            </div>
            <div class="glass-card p-4">
                <div class="text-sm text-gray-500">Learning Cycles</div>
                <div class="text-2xl font-bold text-blue-600" id="cycles">0</div>
                <div class="text-xs text-gray-400 mt-1">Training iterations</div>
            </div>
        </div>

        <!-- Sport Selection -->
        <div class="glass-card p-6">
            <h2 class="text-xl font-bold text-gray-900 mb-4">Select Sport</h2>
            <div class="grid grid-cols-2 md:grid-cols-5 gap-3">
                <button onclick="selectSport('americanfootball_nfl', 'NFL')" class="sport-btn p-4 border-2 border-gray-300 rounded-lg hover:border-purple-500 hover:bg-purple-50 transition">
                    <div class="text-2xl mb-2">üèà</div>
                    <div class="font-semibold">NFL</div>
                </button>
                <button onclick="selectSport('basketball_nba', 'NBA')" class="sport-btn p-4 border-2 border-gray-300 rounded-lg hover:border-purple-500 hover:bg-purple-50 transition">
                    <div class="text-2xl mb-2">üèÄ</div>
                    <div class="font-semibold">NBA</div>
                </button>
                <button onclick="selectSport('icehockey_nhl', 'NHL')" class="sport-btn p-4 border-2 border-gray-300 rounded-lg hover:border-purple-500 hover:bg-purple-50 transition">
                    <div class="text-2xl mb-2">üèí</div>
                    <div class="font-semibold">NHL</div>
                </button>
                <button onclick="selectSport('baseball_mlb', 'MLB')" class="sport-btn p-4 border-2 border-gray-300 rounded-lg hover:border-purple-500 hover:bg-purple-50 transition">
                    <div class="text-2xl mb-2">‚öæ</div>
                    <div class="font-semibold">MLB</div>
                </button>
                <button onclick="selectSport('americanfootball_ncaaf', 'NCAAF')" class="sport-btn p-4 border-2 border-gray-300 rounded-lg hover:border-purple-500 hover:bg-purple-50 transition">
                    <div class="text-2xl mb-2">üéì</div>
                    <div class="font-semibold">NCAAF</div>
                </button>
            </div>
            <div class="mt-4 text-center">
                <span class="text-gray-600">Selected: </span>
                <span class="font-bold text-purple-600" id="selectedSport">None</span>
            </div>
        </div>

        <!-- AI Control Panel -->
        <div class="glass-card p-6">
            <h2 class="text-xl font-bold text-gray-900 mb-4">üß† AI Control Panel</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <button id="analyzeBtn" onclick="analyzeGames()" class="bg-gradient-to-r from-purple-600 to-blue-600 text-white font-bold py-4 px-6 rounded-lg hover:from-purple-700 hover:to-blue-700 transition shadow-lg disabled:opacity-50">
                    <div class="text-lg">üîç Analyze Games</div>
                    <div class="text-xs opacity-90">Find value bets with AI</div>
                </button>
                <button id="settleBtn" onclick="settleBets()" class="bg-gradient-to-r from-green-600 to-teal-600 text-white font-bold py-4 px-6 rounded-lg hover:from-green-700 hover:to-teal-700 transition shadow-lg disabled:opacity-50">
                    <div class="text-lg">‚úÖ Settle Results</div>
                    <div class="text-xs opacity-90">Get real game outcomes</div>
                </button>
                <button id="learnBtn" onclick="runLearningCycle()" class="bg-gradient-to-r from-orange-600 to-red-600 text-white font-bold py-4 px-6 rounded-lg hover:from-orange-700 hover:to-red-700 transition shadow-lg disabled:opacity-50">
                    <div class="text-lg">üéì Learn & Improve</div>
                    <div class="text-xs opacity-90">AI self-improvement</div>
                </button>
            </div>
        </div>

        <!-- AI Predictions -->
        <div class="glass-card p-6">
            <h2 class="text-xl font-bold text-gray-900 mb-4">üéØ AI Predictions</h2>
            <div id="predictions" class="space-y-3">
                <div class="text-center text-gray-400 py-8">
                    Click "Analyze Games" to start AI analysis
                </div>
            </div>
        </div>

        <!-- Learning Insights -->
        <div class="glass-card p-6">
            <h2 class="text-xl font-bold text-gray-900 mb-4">üìä AI Learning Insights</h2>
            <div id="insights" class="space-y-4">
                <div class="text-center text-gray-400 py-8">
                    AI insights will appear after learning cycles
                </div>
            </div>
        </div>

    </div>

    <script>
        // Configuration
        const ODDS_API_KEY = '28beb23f0f84301404f98f2951928b52';
        let currentSport = null;
        let currentSportName = '';
        let predictions = [];
        
        // AI Learning Model
        class BettingAI {
            constructor() {
                this.loadModel();
            }
            
            loadModel() {
                const saved = localStorage.getItem('bettingAI_model');
                if (saved) {
                    this.model = JSON.parse(saved);
                } else {
                    this.model = {
                        totalBets: 0,
                        wins: 0,
                        losses: 0,
                        learningCycles: 0,
                        patterns: {
                            spreadSuccess: { over: 0, under: 0, total: 0 },
                            moneylineSuccess: { favorite: 0, underdog: 0, total: 0 },
                            oddsRanges: {},
                            teamPerformance: {}
                        },
                        weights: {
                            oddsDiscrepancy: 1.0,
                            homeAdvantage: 0.3,
                            marketEfficiency: 0.5
                        }
                    };
                }
            }
            
            saveModel() {
                localStorage.setItem('bettingAI_model', JSON.stringify(this.model));
                updateStats();
            }
            
            analyzeGame(game) {
                if (!game.bookmakers || game.bookmakers.length < 2) return null;
                
                const homeTeam = game.home_team;
                const awayTeam = game.away_team;
                
                // Collect all odds
                const h2hOdds = [];
                const spreadOdds = [];
                
                game.bookmakers.forEach(book => {
                    const h2h = book.markets?.find(m => m.key === 'h2h');
                    const spread = book.markets?.find(m => m.key === 'spreads');
                    
                    if (h2h) h2hOdds.push(h2h.outcomes);
                    if (spread) spreadOdds.push(spread.outcomes);
                });
                
                if (h2hOdds.length === 0) return null;
                
                // Calculate average odds and find discrepancies
                const avgHomeOdds = this.calculateAverage(h2hOdds.map(o => o.find(x => x.name === homeTeam)?.price || 0));
                const avgAwayOdds = this.calculateAverage(h2hOdds.map(o => o.find(x => x.name === awayTeam)?.price || 0));
                
                // Find best odds (arbitrage opportunity)
                const bestHomeOdds = Math.max(...h2hOdds.map(o => o.find(x => x.name === homeTeam)?.price || 0));
                const bestAwayOdds = Math.max(...h2hOdds.map(o => o.find(x => x.name === awayTeam)?.price || 0));
                
                // Calculate discrepancy (value indicator)
                const homeDiscrepancy = ((bestHomeOdds - avgHomeOdds) / avgHomeOdds) * 100;
                const awayDiscrepancy = ((bestAwayOdds - avgAwayOdds) / avgAwayOdds) * 100;
                
                // Calculate implied probabilities
                const homeImplied = this.oddsToProb(avgHomeOdds);
                const awayImplied = this.oddsToProb(avgAwayOdds);
                
                // Apply AI learning weights
                const homeScore = homeDiscrepancy * this.model.weights.oddsDiscrepancy + 
                                 (5 * this.model.weights.homeAdvantage);
                const awayScore = awayDiscrepancy * this.model.weights.oddsDiscrepancy;
                
                // Determine best bet
                let pick = null;
                if (homeScore > 2 && homeScore > awayScore) {
                    pick = {
                        team: homeTeam,
                        opponent: awayTeam,
                        odds: bestHomeOdds,
                        avgOdds: avgHomeOdds,
                        discrepancy: homeDiscrepancy.toFixed(2),
                        confidence: Math.min(95, 50 + homeScore * 5),
                        type: 'moneyline',
                        implied: homeImplied
                    };
                } else if (awayScore > 2 && awayScore > homeScore) {
                    pick = {
                        team: awayTeam,
                        opponent: homeTeam,
                        odds: bestAwayOdds,
                        avgOdds: avgAwayOdds,
                        discrepancy: awayDiscrepancy.toFixed(2),
                        confidence: Math.min(95, 50 + awayScore * 5),
                        type: 'moneyline',
                        implied: awayImplied
                    };
                }
                
                if (pick) {
                    pick.game = `${awayTeam} @ ${homeTeam}`;
                    pick.gameTime = game.commence_time;
                    pick.gameId = game.id;
                }
                
                return pick;
            }
            
            calculateAverage(arr) {
                const filtered = arr.filter(x => x > 0);
                return filtered.length > 0 ? filtered.reduce((a, b) => a + b, 0) / filtered.length : 0;
            }
            
            oddsToProb(odds) {
                if (odds > 0) {
                    return (100 / (odds + 100) * 100).toFixed(1);
                } else {
                    return (Math.abs(odds) / (Math.abs(odds) + 100) * 100).toFixed(1);
                }
            }
            
            recordResult(prediction, won) {
                this.model.totalBets++;
                if (won) {
                    this.model.wins++;
                    if (prediction.type === 'moneyline') {
                        this.model.patterns.moneylineSuccess.total++;
                    }
                } else {
                    this.model.losses++;
                }
                
                // Update team performance tracking
                const team = prediction.team;
                if (!this.model.patterns.teamPerformance[team]) {
                    this.model.patterns.teamPerformance[team] = { wins: 0, total: 0 };
                }
                this.model.patterns.teamPerformance[team].total++;
                if (won) this.model.patterns.teamPerformance[team].wins++;
                
                this.saveModel();
            }
            
            learn() {
                this.model.learningCycles++;
                
                // Adjust weights based on success rates
                const winRate = this.model.wins / this.model.totalBets;
                
                if (winRate < 0.45) {
                    // Increase selectivity
                    this.model.weights.oddsDiscrepancy *= 1.1;
                    this.model.weights.marketEfficiency *= 1.05;
                } else if (winRate > 0.60) {
                    // Model is working, maintain
                    this.model.weights.oddsDiscrepancy *= 0.98;
                }
                
                this.saveModel();
                
                return this.generateInsights();
            }
            
            generateInsights() {
                const winRate = ((this.model.wins / this.model.totalBets) * 100).toFixed(1);
                const insights = [];
                
                insights.push(`**Win Rate**: ${winRate}% (${this.model.wins} wins, ${this.model.losses} losses)`);
                
                if (this.model.totalBets > 10) {
                    if (winRate > 55) {
                        insights.push(`‚úÖ **Strong Performance**: AI is beating the market by ${(winRate - 52.4).toFixed(1)}%`);
                    } else if (winRate < 45) {
                        insights.push(`‚ö†Ô∏è **Adjustment Needed**: Increasing selectivity to improve accuracy`);
                    }
                }
                
                insights.push(`**Current Strategy**: Focusing on odds discrepancies (weight: ${this.model.weights.oddsDiscrepancy.toFixed(2)})`);
                
                // Top performing teams
                const topTeams = Object.entries(this.model.patterns.teamPerformance)
                    .filter(([_, data]) => data.total >= 3)
                    .map(([team, data]) => ({ team, rate: (data.wins / data.total * 100).toFixed(0) }))
                    .sort((a, b) => b.rate - a.rate)
                    .slice(0, 3);
                
                if (topTeams.length > 0) {
                    insights.push(`**Top Teams**: ${topTeams.map(t => `${t.team} (${t.rate}%)`).join(', ')}`);
                }
                
                return insights;
            }
        }
        
        const ai = new BettingAI();
        
        function selectSport(sportKey, sportName) {
            currentSport = sportKey;
            currentSportName = sportName;
            document.getElementById('selectedSport').textContent = sportName;
            document.querySelectorAll('.sport-btn').forEach(btn => {
                btn.classList.remove('border-purple-500', 'bg-purple-50');
            });
            event.target.closest('.sport-btn').classList.add('border-purple-500', 'bg-purple-50');
        }
        
        async function analyzeGames() {
            if (!currentSport) {
                alert('Please select a sport first!');
                return;
            }
            
            const btn = document.getElementById('analyzeBtn');
            btn.disabled = true;
            btn.innerHTML = '<div class="text-lg">‚è≥ Analyzing...</div><div class="text-xs opacity-90">AI at work</div>';
            
            try {
                const url = `https://api.the-odds-api.com/v4/sports/${currentSport}/odds?apiKey=${ODDS_API_KEY}&regions=us&markets=h2h,spreads&oddsFormat=american`;
                console.log('Fetching:', url.replace(ODDS_API_KEY, 'KEY_HIDDEN'));
                
                const response = await fetch(url);
                console.log('Response status:', response.status);
                
                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`API error ${response.status}: ${errorText}`);
                }
                
                const games = await response.json();
                console.log(`Received ${games.length} games`);
                
                if (!Array.isArray(games) || games.length === 0) {
                    alert('‚ö†Ô∏è No games available for ' + currentSportName + ' right now. Try another sport!');
                    btn.disabled = false;
                    btn.innerHTML = '<div class="text-lg">üîç Analyze Games</div><div class="text-xs opacity-90">Find value bets with AI</div>';
                    return;
                }
                
                predictions = [];
                games.forEach(game => {
                    const pick = ai.analyzeGame(game);
                    if (pick) predictions.push(pick);
                });
                
                // Sort by confidence
                predictions.sort((a, b) => b.confidence - a.confidence);
                
                // Take top 5
                predictions = predictions.slice(0, 5);
                
                displayPredictions();
                
            } catch (error) {
                console.error('Full error:', error);
                alert('Error fetching games: ' + error.message + '\n\nCheck browser console for details.');
            }
            
            btn.disabled = false;
            btn.innerHTML = '<div class="text-lg">üîç Analyze Games</div><div class="text-xs opacity-90">Find value bets with AI</div>';
        }
        
        function displayPredictions() {
            const container = document.getElementById('predictions');
            
            if (predictions.length === 0) {
                container.innerHTML = '<div class="text-center text-gray-400 py-8">No high-value bets found. AI is being selective! üéØ</div>';
                return;
            }
            
            container.innerHTML = predictions.map((p, i) => `
                <div class="border-2 ${p.settled ? (p.won ? 'border-green-400 bg-green-50' : 'border-red-400 bg-red-50') : 'border-gray-200'} rounded-lg p-4 hover:border-purple-400 transition">
                    <div class="flex items-start justify-between">
                        <div class="flex-1">
                            <div class="flex items-center gap-2">
                                <span class="text-2xl">${p.settled ? (p.won ? '‚úÖ' : '‚ùå') : (p.confidence > 70 ? 'ü§ñ' : 'üìä')}</span>
                                <div>
                                    <div class="font-bold text-lg text-gray-900">
                                        ${p.game}
                                        ${p.settled ? `<span class="ml-2 text-sm ${p.won ? 'text-green-600' : 'text-red-600'}">(${p.finalScore})</span>` : ''}
                                    </div>
                                    <div class="text-sm text-gray-500">
                                        ${new Date(p.gameTime).toLocaleString()}
                                        ${p.settled ? `<span class="ml-2 font-bold ${p.won ? 'text-green-600' : 'text-red-600'}">${p.won ? 'WON' : 'LOST'}</span>` : '<span class="ml-2 text-orange-600">PENDING</span>'}
                                    </div>
                                </div>
                            </div>
                            <div class="mt-3 grid grid-cols-2 gap-3">
                                <div>
                                    <div class="text-xs text-gray-500">AI Pick</div>
                                    <div class="font-bold text-purple-600">${p.team}</div>
                                </div>
                                <div>
                                    <div class="text-xs text-gray-500">Best Odds</div>
                                    <div class="font-bold text-green-600">${p.odds > 0 ? '+' : ''}${p.odds}</div>
                                </div>
                                <div>
                                    <div class="text-xs text-gray-500">Value Found</div>
                                    <div class="font-bold text-orange-600">+${p.discrepancy}%</div>
                                </div>
                                <div>
                                    <div class="text-xs text-gray-500">Win Probability</div>
                                    <div class="font-bold text-blue-600">${p.implied}%</div>
                                </div>
                            </div>
                        </div>
                        <div class="ml-4 text-right">
                            <div class="text-xs text-gray-500">AI Confidence</div>
                            <div class="text-3xl font-bold text-purple-600">${p.confidence.toFixed(0)}%</div>
                            ${p.confidence > 70 ? '<div class="text-xs text-green-600 font-bold mt-1">‚ú® HIGH CONFIDENCE</div>' : ''}
                        </div>
                    </div>
                    <div class="mt-3 pt-3 border-t border-gray-200">
                        <div class="text-xs text-gray-600">
                            <strong>AI Analysis:</strong> Detected ${p.discrepancy}% odds advantage. Market inefficiency suggests value bet on ${p.team}.
                        </div>
                    </div>
                </div>
            `).join('');
        }
        
        async function settleBets() {
            if (predictions.length === 0) {
                alert('No predictions to settle. Analyze games first!');
                return;
            }
            
            const btn = document.getElementById('settleBtn');
            btn.disabled = true;
            btn.innerHTML = '<div class="text-lg">‚è≥ Settling...</div><div class="text-xs opacity-90">Getting results</div>';
            
            try {
                const response = await fetch(`https://api.the-odds-api.com/v4/sports/${currentSport}/scores?apiKey=${ODDS_API_KEY}&daysFrom=3`);
                const scores = await response.json();
                
                let settled = 0;
                predictions.forEach(pred => {
                    const score = scores.find(s => s.id === pred.gameId);
                    if (score && score.completed) {
                        const homeScore = score.scores?.find(s => s.name === score.home_team)?.score;
                        const awayScore = score.scores?.find(s => s.name === score.away_team)?.score;
                        
                        if (homeScore !== undefined && awayScore !== undefined) {
                            const winner = homeScore > awayScore ? score.home_team : score.away_team;
                            const won = winner === pred.team;
                            
                            ai.recordResult(pred, won);
                            pred.settled = true;
                            pred.won = won;
                            pred.finalScore = `${awayScore}-${homeScore}`;
                            settled++;
                        }
                    }
                });
                
                if (settled > 0) {
                    displayPredictions();
                    alert(`‚úÖ Settled ${settled} bets! AI is learning from results...`);
                } else {
                    alert('‚è∞ Games not finished yet. Check back later!');
                }
                
            } catch (error) {
                alert('Error fetching scores: ' + error.message);
            }
            
            btn.disabled = false;
            btn.innerHTML = '<div class="text-lg">‚úÖ Settle Results</div><div class="text-xs opacity-90">Get real game outcomes</div>';
        }
        
        function runLearningCycle() {
            const insights = ai.learn();
            
            const container = document.getElementById('insights');
            container.innerHTML = `
                <div class="bg-gradient-to-r from-purple-50 to-blue-50 border-2 border-purple-200 rounded-lg p-6">
                    <h3 class="text-lg font-bold text-purple-900 mb-3">üéì AI Learning Complete</h3>
                    <div class="space-y-2 text-sm text-gray-700">
                        ${insights.map(insight => `<div>‚Ä¢ ${insight}</div>`).join('')}
                    </div>
                </div>
            `;
            
            updateStats();
            
            alert('üß† AI has completed a learning cycle and updated its strategy!');
        }
        
        function updateStats() {
            document.getElementById('totalBets').textContent = ai.model.totalBets;
            document.getElementById('winRate').textContent = ai.model.totalBets > 0 ? 
                ((ai.model.wins / ai.model.totalBets) * 100).toFixed(1) + '%' : '0%';
            document.getElementById('confidence').textContent = 
                (Math.min(95, 50 + (ai.model.totalBets * 2))).toFixed(0) + '%';
            document.getElementById('cycles').textContent = ai.model.learningCycles;
        }
        
        // Initialize
        updateStats();
    </script>
</body>
</html>
